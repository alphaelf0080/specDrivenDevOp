<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¹ç‹€åœ–æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        h1 { color: #333; }
        .section {
            background: #f5f5f5;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow-x: auto;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸŒ³ æ¨¹ç‹€åœ–è³‡æ–™åº«æ¸¬è©¦</h1>
    
    <div class="section">
        <h2>1. æ¸¬è©¦å°ˆæ¡ˆ API</h2>
        <button onclick="testGetProjects()">ç²å–å°ˆæ¡ˆåˆ—è¡¨</button>
        <button onclick="testGetProject(4)">ç²å–å°ˆæ¡ˆ #4</button>
        <pre id="projectResult"></pre>
    </div>

    <div class="section">
        <h2>2. æ¸¬è©¦æ¨¹ç‹€åœ– API</h2>
        <button onclick="testCreateTree()">ç‚ºå°ˆæ¡ˆ #4 å‰µå»ºæ¨¹ç‹€åœ–</button>
        <button onclick="testGetTrees()">ç²å–æ¨¹ç‹€åœ–åˆ—è¡¨</button>
        <button onclick="testGetProjectMainTree(4)">ç²å–å°ˆæ¡ˆ #4 ä¸»è¦æ¨¹ç‹€åœ–</button>
        <pre id="treeResult"></pre>
    </div>

    <div class="section">
        <h2>3. æ¸¬è©¦æ›´æ–°æ¨¹ç‹€åœ–</h2>
        <input type="number" id="treeId" placeholder="Tree ID" value="1" style="padding: 8px; margin: 5px;">
        <button onclick="testUpdateTree()">æ›´æ–°æ¨¹ç‹€åœ–</button>
        <pre id="updateResult"></pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:5010/api';

        async function apiCall(url, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${url}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                const data = await response.json();
                return { success: response.ok, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function display(elementId, data) {
            document.getElementById(elementId).textContent = JSON.stringify(data, null, 2);
        }

        // å°ˆæ¡ˆæ¸¬è©¦
        async function testGetProjects() {
            const result = await apiCall('/projects');
            display('projectResult', result);
        }

        async function testGetProject(id) {
            const result = await apiCall(`/projects/${id}`);
            display('projectResult', result);
        }

        // æ¨¹ç‹€åœ–æ¸¬è©¦
        async function testCreateTree() {
            const treeData = {
                name: "Test Project - å°ˆæ¡ˆæ¨¹ç‹€åœ–",
                description: "æ¸¬è©¦æ¨¹ç‹€åœ–",
                projectId: 4,
                treeType: "ui_layout",
                direction: "LR",
                data: {
                    id: "root",
                    label: "å°ˆæ¡ˆæ ¹ç¯€é»",
                    children: [
                        {
                            id: "node-1",
                            label: "å­ç¯€é» 1",
                            children: []
                        },
                        {
                            id: "node-2",
                            label: "å­ç¯€é» 2",
                            children: []
                        }
                    ]
                },
                setAsMain: true
            };
            
            const result = await apiCall('/trees', {
                method: 'POST',
                body: JSON.stringify(treeData)
            });
            display('treeResult', result);
        }

        async function testGetTrees() {
            const result = await apiCall('/trees');
            display('treeResult', result);
        }

        async function testGetProjectMainTree(projectId) {
            const result = await apiCall(`/trees/project/${projectId}/main`);
            display('treeResult', result);
        }

        async function testUpdateTree() {
            const treeId = document.getElementById('treeId').value;
            const updateData = {
                data: {
                    id: "root",
                    label: "æ›´æ–°å¾Œçš„æ ¹ç¯€é»",
                    children: [
                        {
                            id: "node-1",
                            label: "æ›´æ–°çš„å­ç¯€é» 1",
                            children: []
                        },
                        {
                            id: "node-2",
                            label: "æ›´æ–°çš„å­ç¯€é» 2",
                            children: [
                                {
                                    id: "node-2-1",
                                    label: "æ–°çš„å­«ç¯€é»",
                                    children: []
                                }
                            ]
                        },
                        {
                            id: "node-3",
                            label: "æ–°å¢çš„å­ç¯€é» 3",
                            children: []
                        }
                    ]
                }
            };
            
            const result = await apiCall(`/trees/${treeId}`, {
                method: 'PUT',
                body: JSON.stringify(updateData)
            });
            display('updateResult', result);
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦
        window.onload = () => {
            console.log('ğŸš€ æ¸¬è©¦é é¢å·²è¼‰å…¥');
            testGetProjects();
        };
    </script>
</body>
</html>
