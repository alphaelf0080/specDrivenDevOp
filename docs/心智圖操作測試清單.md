# 心智圖操作測試清單

## 測試環境
- 前端：http://localhost:3030/?view=sdd-mindmap
- 後端：http://localhost:3020

## 測試項目

### ✅ 基本功能測試

#### 1. 右鍵選單顯示
- [ ] 在節點上按右鍵，是否顯示選單？
- [ ] 在連接線上按右鍵，是否顯示選單？
- [ ] 在空白處按右鍵，是否顯示選單？
- [ ] 按 ESC 鍵，選單是否關閉？
- [ ] 點擊選單外部，選單是否關閉？

#### 2. 新增節點
**步驟：**
1. 在任一節點上按右鍵
2. 選擇「➕ 新增子節點」
3. 檢查：
   - [ ] 新節點是否出現？
   - [ ] 新節點是否連接到父節點？
   - [ ] 瀏覽器 Console 是否顯示 "🆕 Adding new node"？
   - [ ] 後端是否收到 POST 請求？
   - [ ] 重新整理頁面，新節點是否保留？

#### 3. 刪除節點
**步驟：**
1. 在任一節點上按右鍵
2. 選擇「🗑️ 刪除節點」
3. 檢查：
   - [ ] 節點是否消失？
   - [ ] 連接線是否一起刪除？
   - [ ] Console 是否顯示 "🗑️ Deleting node"？
   - [ ] 後端是否收到 POST 請求？
   - [ ] 重新整理頁面，節點是否真的被刪除？

#### 4. 編輯節點樣式
**步驟：**
1. 在節點上按右鍵
2. 選擇「🎨 編輯節點樣式」
3. 樣式編輯器是否開啟？
4. 測試快速配色：
   - [ ] 點擊藍色配色，節點是否變藍？
   - [ ] 點擊綠色配色，節點是否變綠？
5. 測試自訂顏色：
   - [ ] 調整背景顏色，預覽是否更新？
   - [ ] 調整邊框顏色，預覽是否更新？
   - [ ] 調整文字顏色，預覽是否更新？
6. 測試尺寸調整：
   - [ ] 拖動邊框寬度滑桿，預覽是否更新？
   - [ ] 拖動文字大小滑桿，預覽是否更新？
   - [ ] 拖動圓角滑桿，預覽是否更新？
7. 點擊「儲存」
8. 檢查：
   - [ ] 編輯器是否關閉？
   - [ ] 節點樣式是否套用？
   - [ ] Console 是否顯示 "✅ Layout saved"？
   - [ ] 重新整理頁面，樣式是否保留？

#### 5. 編輯連接線樣式
**步驟：**
1. 在連接線上按右鍵
2. 選擇「🎨 編輯連接線樣式」
3. 樣式編輯器是否開啟？
4. 測試線條顏色：
   - [ ] 調整顏色，預覽是否更新？
5. 測試線條寬度：
   - [ ] 拖動滑桿，預覽是否更新？
6. 測試線條樣式：
   - [ ] 選擇「虛線」，預覽是否顯示虛線？
   - [ ] 選擇「點線」，預覽是否顯示點線？
7. 測試動畫：
   - [ ] 勾選動畫，預覽是否顯示動畫效果？
8. 點擊「儲存」
9. 檢查：
   - [ ] 編輯器是否關閉？
   - [ ] 連接線樣式是否套用？
   - [ ] 重新整理頁面，樣式是否保留？

#### 6. 拖曳節點
**步驟：**
1. 拖曳任一節點到新位置
2. 檢查：
   - [ ] 節點位置是否改變？
   - [ ] Console 是否顯示 "✅ Layout saved"？
   - [ ] 後端是否收到 POST 請求？
   - [ ] 重新整理頁面，位置是否保留？

### 🔧 進階測試

#### 7. 連續操作
**步驟：**
1. 新增 3 個節點
2. 刪除 1 個節點
3. 編輯 2 個節點的樣式
4. 拖曳 5 個節點
5. 重新整理頁面
6. 檢查：
   - [ ] 所有變更是否都保留？
   - [ ] 節點數量是否正確？
   - [ ] 樣式是否正確？
   - [ ] 位置是否正確？

#### 8. 重置布局
**步驟：**
1. 進行一些變更
2. 點擊「🔄 重置布局」按鈕
3. 檢查：
   - [ ] 是否回到預設布局？
   - [ ] 自訂樣式是否被清除？

#### 9. 錯誤處理
**測試情境：**
- [ ] 後端關閉時操作，是否顯示錯誤訊息？
- [ ] 網路中斷時操作，是否正常處理？
- [ ] 刪除不存在的節點，是否有錯誤處理？

### 📊 效能測試

#### 10. 大量操作
**步驟：**
1. 新增 10 個節點
2. 檢查：
   - [ ] 頁面是否流暢？
   - [ ] 是否有卡頓？
   - [ ] 記憶體使用是否正常？

## 已知問題

### 問題 1：新增節點後沒有保存
**狀態：** 🔧 修復中
**原因：** 使用閉包中的舊 nodes 狀態
**解決方案：** 使用 setState 的函數式更新，並透過回調獲取最新狀態

### 問題 2：樣式變更後沒有保存
**狀態：** ✅ 已修復
**原因：** 同上
**解決方案：** 在 setState 回調中觸發保存

## 除錯技巧

### 查看 Console 日誌
開啟瀏覽器開發者工具（F12），切換到 Console 標籤，應該看到：
```
📍 Loading saved layout from server: X nodes
🆕 Adding new node to parent: node-xxx
✅ Node added, saving layout...
✅ Layout saved to server
```

### 查看網路請求
切換到 Network 標籤，篩選 XHR，應該看到：
- `GET /api/mindmap/layout/sdd-mindmap` - 載入布局
- `POST /api/mindmap/layout/sdd-mindmap` - 保存布局
- `DELETE /api/mindmap/layout/sdd-mindmap` - 刪除布局

### 查看後端日誌
在後端終端中應該看到：
```
GET /api/mindmap/layout/sdd-mindmap 200 X.XXX ms - XXX
POST /api/mindmap/layout/sdd-mindmap 200 X.XXX ms - XX
```

### 查看保存的資料
```bash
cat /Users/alpha/Documents/projects/specDrivenDevOp/data/sdd-mindmap-layout.json
```

應該看到 JSON 格式的位置資料。

## 測試結果

測試日期：____________________
測試人員：____________________

### 通過的測試
- [ ] 1. 右鍵選單顯示
- [ ] 2. 新增節點
- [ ] 3. 刪除節點
- [ ] 4. 編輯節點樣式
- [ ] 5. 編輯連接線樣式
- [ ] 6. 拖曳節點
- [ ] 7. 連續操作
- [ ] 8. 重置布局
- [ ] 9. 錯誤處理
- [ ] 10. 效能測試

### 備註

_______________________________________________________________

_______________________________________________________________

_______________________________________________________________
