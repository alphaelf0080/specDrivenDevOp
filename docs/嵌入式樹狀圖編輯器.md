# 嵌入式樹狀圖編輯器（無導航和工具列版本）

## 📋 更新說明

創建了精簡的 `EmbeddedTreeDiagram` 組件，**移除左側導航區和上方工具列**，只保留核心編輯功能和右側屬性面板。

## ✨ 組件特點

### 保留的功能 ✅

#### 1. **樹狀圖主編輯區**
- ✅ 完整的 ReactFlow 樹狀圖顯示
- ✅ 節點選擇功能
- ✅ 雙擊編輯節點名稱
- ✅ 右鍵選單（新增/刪除）
- ✅ 縮放和平移控制
- ✅ 深度配色系統

#### 2. **右側屬性面板** (320px 寬，可摺疊)
- ✅ 節點詳細資訊
- ✅ 即時編輯節點名稱
- ✅ 顯示節點 ID 和深度
- ✅ 顯示 Metadata（座標、功能、描述等）
- ✅ 快捷操作按鈕（新增子節點、刪除節點）
- ✅ 快捷鍵說明

#### 3. **鍵盤快捷鍵**
- ✅ `Tab` - 新增子節點
- ✅ `Delete` - 刪除節點
- ✅ `Esc` - 取消選擇/關閉選單
- ✅ `Enter` - 確認編輯
- ✅ 雙擊節點 - 開始編輯

#### 4. **右鍵選單**
- ✅ 新增子節點
- ✅ 刪除節點（根節點保護）

### 移除的功能 ❌

#### 1. **左側導航區** (原 80px)
- ❌ 過濾工具 🔍
- ❌ 圖層管理 📚
- ❌ 書籤功能 🔖
- ❌ 設定選項 ⚙️
- ❌ 匯出功能 💾
- ❌ 分享連結 🔗

#### 2. **上方工具列**
- ❌ 返回首頁按鈕
- ❌ 樹枝圖標題
- ❌ 全部展開按鈕

## 🎨 布局設計

### 整體結構
```
┌─────────────────────────────────────────────┐
│                                             │
│            樹狀圖主編輯區                     │
│         (ReactFlow + 控制元件)               │
│                                             │
│                                             │
│                                             │
├─────────────────────────────────────────────┤
│               右側屬性面板 (320px, 可摺疊)     │
│  ┌─────────────────────────────────────┐   │
│  │ 節點屬性                              │   │
│  │ - 節點名稱 (可編輯)                   │   │
│  │ - ID                                 │   │
│  │ - 深度                               │   │
│  │ - 功能/描述                          │   │
│  │ - 座標                               │   │
│  │                                      │   │
│  │ [新增子節點] [刪除節點]               │   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

### Grid 布局
```css
.embedded-tree-container {
  display: grid;
  grid-template-columns: 1fr 320px;
}
```

## 🔧 技術實現

### 組件結構

```typescript
// EmbeddedTreeDiagram.tsx
export type EmbeddedTreeDiagramProps = {
  data: TreeNode;
  direction?: 'LR' | 'TB';
  onNodeUpdate?: (nodeId: string, updates: Partial<TreeNode>) => void;
  onAddNode?: (parentNodeId: string) => void;
  onDeleteNode?: (nodeId: string) => void;
};
```

### 核心功能

#### 1. **節點選擇和編輯**
```typescript
const onNodeClick = (event, node) => {
  setSelectedNode(node);
  setIsPanelOpen(true);
};

const onNodeDoubleClick = (event, node) => {
  setSelectedNode(node);
  setEditLabel(node.data.label);
  setIsEditing(true);
};
```

#### 2. **鍵盤快捷鍵**
```typescript
useEffect(() => {
  const handleKeyDown = (event: KeyboardEvent) => {
    if (event.key === 'Tab' && onAddNode) {
      event.preventDefault();
      onAddNode(selectedNode.id);
    } else if (event.key === 'Delete' && onDeleteNode) {
      event.preventDefault();
      onDeleteNode(selectedNode.id);
    }
  };
  document.addEventListener('keydown', handleKeyDown);
}, [selectedNode, onAddNode, onDeleteNode]);
```

#### 3. **右鍵選單**
```typescript
const onNodeContextMenu = (event, node) => {
  event.preventDefault();
  setContextMenu({ x: event.clientX, y: event.clientY, node });
};
```

## 📁 檔案清單

### 新增檔案
1. **`client/components/Tree/EmbeddedTreeDiagram.tsx`** (380 行)
   - 精簡版樹狀圖組件
   - 無左側導航和上方工具列
   - 保留核心編輯功能

2. **`client/components/Tree/EmbeddedTreeDiagram.css`** (330 行)
   - 簡化的 CSS 樣式
   - 2欄布局（編輯區 + 屬性面板）
   - 深色主題設計

### 修改檔案
1. **`client/components/Project/ProjectMainWindow.tsx`**
   - 改用 `EmbeddedTreeDiagram` 組件
   - 保留所有資料處理邏輯

## 🎯 使用方式

### 基本操作

#### **選擇節點**
- 點擊任意節點
- 右側面板顯示節點詳細資訊

#### **編輯節點名稱**
**方法 1**: 雙擊節點
**方法 2**: 選擇節點後，在右側面板點擊「✏️」按鈕
**方法 3**: 選擇節點後，在右側面板雙擊節點名稱

#### **新增子節點**
**方法 1**: 選擇父節點，按 `Tab` 鍵
**方法 2**: 右鍵父節點，選擇「➕ 新增子節點」
**方法 3**: 選擇父節點，在右側面板點擊「新增子節點」按鈕

#### **刪除節點**
**方法 1**: 選擇節點，按 `Delete` 鍵
**方法 2**: 右鍵節點，選擇「🗑️ 刪除節點」
**方法 3**: 選擇節點，在右側面板點擊「刪除節點」按鈕

**注意**: 根節點無法刪除

### 快捷鍵列表

| 按鍵 | 功能 |
|------|------|
| `Tab` | 新增子節點到選中的節點 |
| `Delete` | 刪除選中的節點 |
| `Esc` | 取消選擇 / 關閉選單 / 取消編輯 |
| `Enter` | 確認編輯節點名稱 |
| 雙擊節點 | 開始編輯節點名稱 |
| 右鍵節點 | 開啟快捷選單 |

### 視圖控制

- **縮放**: 滑鼠滾輪
- **平移**: 拖曳背景
- **重置視圖**: 右下角控制元件
- **摺疊屬性面板**: 點擊右側箭頭按鈕

## 📊 與完整版的比較

| 功能 | TreeDiagram (完整版) | EmbeddedTreeDiagram |
|------|---------------------|---------------------|
| 左側導航區 | ✅ (80px) | ❌ |
| 上方工具列 | ✅ | ❌ |
| 樹狀圖編輯區 | ✅ | ✅ |
| 右側屬性面板 | ✅ (320px) | ✅ (320px) |
| 節點選擇 | ✅ | ✅ |
| 節點編輯 | ✅ | ✅ |
| 右鍵選單 | ✅ | ✅ (簡化) |
| 快捷鍵 | ✅ | ✅ |
| 返回首頁 | ✅ | ❌ |
| 全部展開 | ✅ | ❌ |
| 工具按鈕 | ✅ | ❌ |
| 寬度 | 80px + 1fr + 320px | 1fr + 320px |
| 檔案大小 | 1228 行 | 380 行 (-69%) |

## ✨ 優勢

### 1. **更簡潔的介面**
- 移除不必要的工具列
- 專注於核心編輯功能
- 更大的編輯區域

### 2. **更適合嵌入**
- 無獨立的導航系統
- 與專案頁面整合更自然
- 不會與專案頁面的導航衝突

### 3. **更輕量級**
- 程式碼減少 69%
- DOM 元素更少
- 渲染效能更好

### 4. **保留核心功能**
- 所有必要的編輯功能都在
- 快捷鍵支援完整
- 屬性面板功能完整

## 🚀 初始化

### 自動建立根節點

開啟專案時，如果沒有樹狀圖資料，會自動建立：

```typescript
setTreeData({ 
  id: 'root', 
  label: project.name || '專案根節點',
  children: [] 
});
```

### 新增第一個子節點

1. 點擊根節點
2. 按 `Tab` 鍵
3. 或右鍵選擇「新增子節點」
4. 新節點自動命名為「新節點」

## ✅ 測試檢查清單

### 基本顯示
- [ ] 開啟專案，樹狀圖正確顯示
- [ ] 根節點使用專案名稱
- [ ] 深度配色正確應用
- [ ] 右側屬性面板可見

### 節點選擇
- [ ] 點擊節點，右側面板顯示詳細資訊
- [ ] 節點 ID、深度正確顯示
- [ ] Metadata 資訊正確顯示

### 節點編輯
- [ ] 雙擊節點可編輯名稱
- [ ] Enter 確認編輯
- [ ] Esc 取消編輯
- [ ] 編輯後自動儲存

### 新增節點
- [ ] Tab 鍵新增子節點
- [ ] 右鍵選單新增子節點
- [ ] 屬性面板按鈕新增子節點
- [ ] 新增後自動儲存

### 刪除節點
- [ ] Delete 鍵刪除節點
- [ ] 右鍵選單刪除節點
- [ ] 屬性面板按鈕刪除節點
- [ ] 根節點無法刪除
- [ ] 刪除後自動儲存

### 右鍵選單
- [ ] 右鍵顯示選單
- [ ] 新增子節點功能正常
- [ ] 刪除節點功能正常
- [ ] 點擊外部關閉選單

### 屬性面板
- [ ] 點擊箭頭摺疊/展開
- [ ] 摺疊時寬度變為 40px
- [ ] 展開時寬度為 320px
- [ ] 快捷鍵說明顯示正確

### 視圖控制
- [ ] 滾輪縮放正常
- [ ] 拖曳平移正常
- [ ] 控制元件功能正常
- [ ] 自動適應視圖

## 📝 相關文件

- [專案樹狀圖整合完成.md](./專案樹狀圖整合完成.md)
- [專案頁面整合完整樹狀圖編輯器.md](./專案頁面整合完整樹狀圖編輯器.md)
- [TreeDiagram 原始組件](../client/components/Tree/TreeDiagram.tsx)

---

**實作日期**: 2025-10-09  
**版本**: 4.0.0 (嵌入式精簡版)  
**狀態**: ✅ 完成
