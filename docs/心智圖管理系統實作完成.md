# å¿ƒæ™ºåœ–ç®¡ç†ç³»çµ±å¯¦ä½œå®Œæˆ

## ğŸ“‹ æ¦‚è¦

å·²æˆåŠŸå¯¦ä½œå®Œæ•´çš„å¤šå¿ƒæ™ºåœ–ç®¡ç†ç³»çµ±ï¼ŒåŒ…å«å‰ç«¯ UIã€å¾Œç«¯ APIã€ä»¥åŠæª”æ¡ˆå„²å­˜ç³»çµ±ã€‚

## âœ… å®Œæˆé …ç›®

### 1. å‰ç«¯å…ƒä»¶

#### **MindMapManager.tsx** (~370 è¡Œ)
- **åŠŸèƒ½**:
  - å¿ƒæ™ºåœ–åˆ—è¡¨é¡¯ç¤ºï¼ˆæ’åºã€ç¯€é»æ•¸ã€æ›´æ–°æ™‚é–“ï¼‰
  - å»ºç«‹æ–°å¿ƒæ™ºåœ–ï¼ˆå« 3 ç¨®ç¯„æœ¬é¸æ“‡ï¼‰
  - inline é‡æ–°å‘½åï¼ˆEnter ç¢ºèªã€Escape å–æ¶ˆï¼‰
  - åˆªé™¤å¿ƒæ™ºåœ–ï¼ˆå«ç¢ºèªå°è©±æ¡†ï¼‰
  - ç•¶å‰é–‹å•Ÿçš„å¿ƒæ™ºåœ–é«˜äº®é¡¯ç¤º

- **ç¯„æœ¬é¸é …**:
  - `blank` - ç©ºç™½å¿ƒæ™ºåœ–
  - `basic` - å–®ä¸€ root ç¯€é»
  - `sdd` - è¤‡è£½ SDD ç¯„æœ¬

#### **SDDMindMap.tsx** æ•´åˆ
- æ–°å¢ state ç®¡ç†:
  ```tsx
  const [showManager, setShowManager] = useState(false);
  const [currentMindMapId, setCurrentMindMapId] = useState(DEFAULT_MINDMAP_ID);
  const [currentMindMapName, setCurrentMindMapName] = useState('SDD+AI é–‹ç™¼æ–¹æ¡ˆ');
  ```

- æ–°å¢å‡½æ•¸:
  - `handleSelectMindMap(id, name)` - åˆ‡æ›å¿ƒæ™ºåœ–ä¸¦é‡æ–°è¼‰å…¥
  
- UI æ›´æ–°:
  - æ¨™é¡Œå‹•æ…‹é¡¯ç¤ºç•¶å‰å¿ƒæ™ºåœ–åç¨±
  - æ–°å¢ã€ŒğŸ“ å¿ƒæ™ºåœ–ç®¡ç†ã€æŒ‰éˆ•
  - æ¸²æŸ“ MindMapManager å…ƒä»¶

### 2. å¾Œç«¯ API

#### **5 å€‹æ–°ç«¯é»**:

```typescript
// 1. åˆ—å‡ºæ‰€æœ‰å¿ƒæ™ºåœ–
GET /api/mindmap/list
Response: { success, mindmaps[], count }

// 2. å»ºç«‹æ–°å¿ƒæ™ºåœ–
POST /api/mindmap/create
Body: { id, name, description?, template }
Response: { success, mindmap }

// 3. å–å¾—å…ƒæ•¸æ“š
GET /api/mindmap/metadata/:id
Response: { success, metadata }

// 4. æ›´æ–°å…ƒæ•¸æ“šï¼ˆé‡æ–°å‘½åï¼‰
PUT /api/mindmap/metadata/:id
Body: { name, description? }
Response: { success, metadata }

// 5. åˆªé™¤å¿ƒæ™ºåœ–
DELETE /api/mindmap/:id
Response: { success, message }
```

### 3. æª”æ¡ˆç³»çµ±

#### **æª”æ¡ˆçµæ§‹**:
```
data/
â”œâ”€â”€ sdd-mindmap-metadata.json    # å…ƒæ•¸æ“š
â”œâ”€â”€ sdd-mindmap-layout.json      # ç¯€é»å¸ƒå±€
â”œâ”€â”€ custom-map-metadata.json     # å…¶ä»–å¿ƒæ™ºåœ–...
â””â”€â”€ custom-map-layout.json
```

#### **å…ƒæ•¸æ“šæ ¼å¼**:
```json
{
  "id": "sdd-mindmap",
  "name": "SDD+AI é–‹ç™¼æ–¹æ¡ˆ",
  "description": "è¦æ ¼é©…å‹•é–‹ç™¼èˆ‡ AI è¼”åŠ©çš„å®Œæ•´é–‹ç™¼æ–¹æ¡ˆè¨ˆåŠƒæ›¸",
  "createdAt": "2025-01-09T00:00:00.000Z",
  "updatedAt": "2025-01-09T14:00:00.000Z",
  "nodeCount": 0
}
```

### 4. é¡å‹å®šç¾©

**client/types/mindmap-manager.ts**:
```typescript
interface MindMapMetadata {
  id: string;
  name: string;
  description?: string;
  createdAt: string;
  updatedAt: string;
  nodeCount: number;
}

interface MindMapListItem {
  id: string;
  name: string;
  createdAt: string;
  updatedAt: string;
  nodeCount: number;
}

interface CreateMindMapRequest {
  id: string;
  name: string;
  description?: string;
  template: 'blank' | 'basic' | 'sdd';
}

interface UpdateMindMapRequest {
  name: string;
  description?: string;
}
```

### 5. æ¨£å¼è¨­è¨ˆ

**MindMapManager.css** (~400 è¡Œ):
- å…¨è¢å¹•é®ç½© overlay
- å¿ƒæ™ºåœ–å¡ç‰‡ï¼ˆhover + active ç‹€æ…‹ï¼‰
- å»ºç«‹å°è©±æ¡†
- ç¯„æœ¬é¸æ“‡å¡ç‰‡
- éŸ¿æ‡‰å¼è¨­è¨ˆ (max-width: 768px)

## ğŸ”§ é—œéµä¿®å¾©

### MindMapCanvas ç•«é¢ä¸æ›´æ–°å•é¡Œ

**å•é¡Œ**: Console é¡¯ç¤º "âœ… Node added" ä½†ç•«é¢ç„¡è®ŠåŒ–

**æ ¹æœ¬åŸå› **: `initialized` æ¨™è¨˜é˜»æ­¢äº†æ‰€æœ‰å¾ŒçºŒæ›´æ–°

**è§£æ±ºæ–¹æ¡ˆ**: æ”¹ç”¨ç¯€é»æ•¸é‡è¿½è¹¤
```tsx
const prevNodeCountRef = useRef(0);

useEffect(() => {
  if (prevNodeCountRef.current !== initialNodes.length) {
    console.log(`ğŸ”„ Node count changed: ${prevNodeCountRef.current} â†’ ${initialNodes.length}`);
    setNodes(initialNodes);
    setEdges(initialEdges);
    prevNodeCountRef.current = initialNodes.length;
  }
}, [initialNodes, initialEdges, setNodes, setEdges]);
```

**æ•ˆæœ**:
- âœ… æ–°å¢/åˆªé™¤ç¯€é»æœƒæ›´æ–°ç•«é¢
- âœ… æ‹–æ›³ç¯€é»ä¸æœƒè§¸ç™¼é‡ç½®
- âœ… ç²¾æº–æ§åˆ¶ï¼Œç„¡å‰¯ä½œç”¨

## ğŸ“ API æ›¿æ›å®Œæˆ

æ‰€æœ‰ `MINDMAP_ID` å·²æ›¿æ›ç‚º `currentMindMapId`:
- Line 53: `loadLayout()` å‡½æ•¸
- Line 123: `handleNodesChange()` å‡½æ•¸
- Line 147: `handleSaveLayout()` å‡½æ•¸
- Line 170: `handleResetLayout()` å‡½æ•¸

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å‰ç«¯ä½¿ç”¨:

1. **é–‹å•Ÿç®¡ç†å™¨**:
   - é»æ“Šã€ŒğŸ“ å¿ƒæ™ºåœ–ç®¡ç†ã€æŒ‰éˆ•

2. **å»ºç«‹æ–°å¿ƒæ™ºåœ–**:
   - é»æ“Šã€Œâ• å»ºç«‹æ–°å¿ƒæ™ºåœ–ã€
   - è¼¸å…¥åç¨±å’Œæè¿°ï¼ˆå¯é¸ï¼‰
   - é¸æ“‡ç¯„æœ¬
   - é»æ“Šã€Œå»ºç«‹ã€

3. **åˆ‡æ›å¿ƒæ™ºåœ–**:
   - åœ¨åˆ—è¡¨ä¸­é»æ“Šå¿ƒæ™ºåœ–å¡ç‰‡

4. **é‡æ–°å‘½å**:
   - é»æ“Šå¿ƒæ™ºåœ–åç¨±å³å´çš„ã€Œâœï¸ã€æŒ‰éˆ•
   - ä¿®æ”¹åç¨±
   - æŒ‰ Enter ç¢ºèªæˆ– Escape å–æ¶ˆ

5. **åˆªé™¤å¿ƒæ™ºåœ–**:
   - é»æ“Šã€ŒğŸ—‘ï¸ã€æŒ‰éˆ•
   - åœ¨ç¢ºèªå°è©±æ¡†ä¸­é»æ“Šã€Œåˆªé™¤ã€

### API ä½¿ç”¨ç¯„ä¾‹:

```bash
# åˆ—å‡ºæ‰€æœ‰å¿ƒæ™ºåœ–
curl http://localhost:5010/api/mindmap/list

# å»ºç«‹æ–°å¿ƒæ™ºåœ–
curl -X POST http://localhost:5010/api/mindmap/create \
  -H "Content-Type: application/json" \
  -d '{
    "id": "my-map",
    "name": "æˆ‘çš„å¿ƒæ™ºåœ–",
    "description": "æ¸¬è©¦å¿ƒæ™ºåœ–",
    "template": "basic"
  }'

# é‡æ–°å‘½å
curl -X PUT http://localhost:5010/api/mindmap/metadata/my-map \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æ–°åç¨±"
  }'

# åˆªé™¤
curl -X DELETE http://localhost:5010/api/mindmap/my-map
```

## ğŸ§ª æ¸¬è©¦ç‹€æ…‹

- âœ… å¾Œç«¯ API å·²é©—è­‰å¯ç”¨
- âœ… åˆ—è¡¨ API è¿”å›æ­£ç¢ºè³‡æ–™
- âœ… é è¨­å¿ƒæ™ºåœ–å…ƒæ•¸æ“šå·²å»ºç«‹
- âœ… å‰ç«¯ç·¨è­¯ç„¡éŒ¯èª¤
- âš ï¸ å®Œæ•´æµç¨‹éœ€è¦åœ¨ç€è¦½å™¨ä¸­æ¸¬è©¦

## ğŸ“ å¾…æ¸¬è©¦é …ç›®

1. é–‹å•Ÿç®¡ç†å™¨ UI
2. å»ºç«‹æ–°å¿ƒæ™ºåœ–ï¼ˆ3 ç¨®ç¯„æœ¬ï¼‰
3. åˆ‡æ›å¿ƒæ™ºåœ–ä¸¦é©—è­‰è³‡æ–™è¼‰å…¥
4. é‡æ–°å‘½ååŠŸèƒ½
5. åˆªé™¤åŠŸèƒ½
6. inline ç·¨è¼¯çš„éµç›¤å¿«æ·éµ

## ğŸ¯ æŠ€è¡“ç´°ç¯€

### ç‹€æ…‹ç®¡ç†
- ä½¿ç”¨ `useState` ç®¡ç† UI ç‹€æ…‹
- ä½¿ç”¨ `useRef` å„ªåŒ–æ•ˆèƒ½ï¼ˆç¯€é»æ•¸é‡è¿½è¹¤ï¼‰
- å¤šå¿ƒæ™ºåœ–ç‹€æ…‹è¿½è¹¤ (currentMindMapId, currentMindMapName)

### æª”æ¡ˆåˆ†é›¢
- **å…ƒæ•¸æ“š**: `{id}-metadata.json` (åç¨±ã€æè¿°ã€æ™‚é–“ã€ç¯€é»æ•¸)
- **å¸ƒå±€**: `{id}-layout.json` (ç¯€é»ä½ç½®è³‡æ–™)
- å„ªé»: å¯ä»¥åªæ›´æ–°å¸ƒå±€è€Œä¸è§¸ç¢°å…ƒæ•¸æ“š

### ç¯„æœ¬ç³»çµ±
- `blank`: ç©ºé™£åˆ— `{ nodes: [], edges: [] }`
- `basic`: å–®ä¸€ root ç¯€é»
- `sdd`: è¤‡è£½å®Œæ•´çš„ SDD ç¯„æœ¬

### éŒ¯èª¤è™•ç†
- å‰ç«¯: try-catch + ä½¿ç”¨è€…å‹å–„éŒ¯èª¤è¨Šæ¯
- å¾Œç«¯: è©³ç´°çš„éŒ¯èª¤æ—¥èªŒ + HTTP ç‹€æ…‹ç¢¼
- æª”æ¡ˆæ“ä½œ: å¤±æ•—æ™‚é™ç´šåˆ°é è¨­è¡Œç‚º

## ğŸ“¦ å°ˆæ¡ˆçµæ§‹

```
client/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ MindMap/
â”‚       â”œâ”€â”€ MindMapCanvas.tsx          # ä¿®å¾©ç•«é¢ä¸æ›´æ–°
â”‚       â”œâ”€â”€ MindMapManager.tsx         # æ–°å»º - ç®¡ç†å™¨ UI
â”‚       â”œâ”€â”€ MindMapManager.css         # æ–°å»º - ç®¡ç†å™¨æ¨£å¼
â”‚       â””â”€â”€ SDDMindMap.tsx             # æ•´åˆç®¡ç†å™¨
â”œâ”€â”€ types/
â”‚   â””â”€â”€ mindmap-manager.ts             # æ–°å»º - é¡å‹å®šç¾©

server/
â”œâ”€â”€ index.ts                           # æ“´å±• - 5 å€‹æ–° API

data/
â”œâ”€â”€ sdd-mindmap-metadata.json          # æ–°å»º - é è¨­å¿ƒæ™ºåœ–å…ƒæ•¸æ“š
â””â”€â”€ sdd-mindmap-layout.json            # ç¾æœ‰ - å¸ƒå±€è³‡æ–™

docs/
â”œâ”€â”€ å•é¡Œä¿®å¾©-ç•«é¢ä¸æ›´æ–°.md              # æ–°å»º - ä¿®å¾©æ–‡æª”
â””â”€â”€ å¿ƒæ™ºåœ–ç®¡ç†ç³»çµ±å¯¦ä½œå®Œæˆ.md            # æœ¬æ–‡æª”
```

## ğŸ”— ç›¸é—œæ–‡æª”

- [å•é¡Œä¿®å¾©-ç•«é¢ä¸æ›´æ–°.md](./å•é¡Œä¿®å¾©-ç•«é¢ä¸æ›´æ–°.md) - è©³ç´°çš„å•é¡Œè¨ºæ–·å’Œä¿®å¾©éç¨‹

## ğŸ’¡ å¾ŒçºŒå»ºè­°

1. **æ•ˆèƒ½å„ªåŒ–**:
   - å¤§å‹å¿ƒæ™ºåœ–çš„è™›æ“¬åŒ–æ¸²æŸ“
   - å¸ƒå±€è¨ˆç®—çš„ Web Worker

2. **åŠŸèƒ½æ“´å±•**:
   - å¿ƒæ™ºåœ–åŒ¯å‡º/åŒ¯å…¥
   - ç‰ˆæœ¬æ§åˆ¶ï¼ˆæ­·å²è¨˜éŒ„ï¼‰
   - å¤šäººå”ä½œ

3. **UX æ”¹é€²**:
   - æ‹–æ”¾é‡æ–°æ’åº
   - å¿«æ·éµæ”¯æ´
   - æœå°‹éæ¿¾

4. **è³‡æ–™æŒä¹…åŒ–**:
   - è³‡æ–™åº«æ•´åˆ
   - é›²ç«¯åŒæ­¥

## ğŸ‰ ç¸½çµ

å®Œæ•´çš„å¿ƒæ™ºåœ–ç®¡ç†ç³»çµ±å·²å¯¦ä½œå®Œæˆï¼ŒåŒ…å«ï¼š
- âœ… å‰ç«¯ç®¡ç†å™¨ UIï¼ˆ370 è¡Œï¼‰
- âœ… å¾Œç«¯ 5 å€‹ API ç«¯é»
- âœ… å®Œæ•´çš„æª”æ¡ˆç³»çµ±
- âœ… é¡å‹å®‰å…¨çš„ TypeScript ä»‹é¢
- âœ… éŸ¿æ‡‰å¼ CSS è¨­è¨ˆ
- âœ… ä¿®å¾©ç•«é¢ä¸æ›´æ–°å•é¡Œ

ç³»çµ±å·²æº–å‚™å¥½é€²è¡Œå®Œæ•´çš„åŠŸèƒ½æ¸¬è©¦ï¼ğŸš€
