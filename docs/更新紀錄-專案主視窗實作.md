# 專案主視窗功能實作 - 更新紀錄

**日期**: 2025年10月9日  
**版本**: Unreleased  
**類型**: 新增功能 (Added)

---

## 📋 概要

實作完整的專案主視窗，採用四色分區布局設計，提供清晰的視覺層次和完整的專案管理介面。

---

## 🎯 實作內容

### 1. 專案主視窗元件 (ProjectMainWindow)

**檔案**: `client/components/Project/ProjectMainWindow.tsx` (131 行)

#### 功能特性
- ✅ 專案資料載入 (GET /api/projects/:id)
- ✅ 五個主要分頁切換:
  - Overview (總覽)
  - Specs (規格文件)
  - Design (設計資源)
  - Develop (開發進度)
  - Test (測試驗證)
- ✅ 載入狀態顯示
- ✅ 錯誤處理與提示
- ✅ 專案資訊顯示 (名稱、類型、狀態、更新時間)

#### TypeScript 介面
```typescript
interface ProjectMainWindowProps {
  projectId: number;
  onClose?: () => void;
}

interface Project {
  id: number;
  uuid: string;
  name: string;
  name_zh: string;
  name_en: string;
  game_type: string;
  description: string;
  status: string;
  owner_id: string;
  created_at: string;
  updated_at: string;
}
```

#### React Hooks 使用
- `useState`: project, loading, error, activeSection
- `useEffect`: 元件載入時自動呼叫 loadProject()

---

### 2. 樣式設計 (ProjectMainWindow.css)

**檔案**: `client/components/Project/ProjectMainWindow.css` (105 行)

#### 布局架構

```
┌──────────────────────────────────────────────────┐
│ 🔵 Header (64px × 100%)                          │
│ 藍色漸層: #3b82f6 → #2563eb                       │
│ 專案圖標 + 標題 + 元數據 + 儲存/關閉按鈕           │
└──────────────────────────────────────────────────┘
┌──────┬────────────────────┬────────────────────┐
│ 🔴   │ 🟢 Preview         │ 🟡 Editor          │
│ Navi │ (280px)            │ (1fr)              │
│(60px)│ 綠色: #22c55e →    │ 黃色: #fbbf24 →    │
│      │       #16a34a      │       #f59e0b      │
│  [O] │                    │                    │
│  [S] │ 專案名稱           │ 麵包屑導航         │
│  [D] │ 遊戲類型           │                    │
│  [V] │                    │ 內容區             │
│  [T] │ 導航選單           │ (可滾動)           │
│      │                    │                    │
└──────┴────────────────────┴────────────────────┘
```

#### CSS 技術細節

**Flexbox + Grid 混合布局**
```css
.project-main-window {
  display: flex;
  flex-direction: column;  /* 垂直排列 header 和 body */
  height: 100vh;
}

.project-body {
  display: grid;
  grid-template-columns: 60px 280px 1fr;  /* 三欄固定+彈性布局 */
  flex: 1;
}
```

**四色漸層設計**
| 區域 | CSS 類別 | 寬度 | 顏色 | 漸層 |
|------|----------|------|------|------|
| Header | `.project-header` | 100% × 64px | 藍色 | `135deg, #3b82f6 → #2563eb` |
| Navi | `.sidebar-narrow` | 60px | 紅色 | `180deg, #ef4444 → #dc2626` |
| Preview | `.sidebar-medium` | 280px | 綠色 | `180deg, #22c55e → #16a34a` |
| Editor | `.main-content-area` | 1fr | 黃色 | `180deg, #fbbf24 → #f59e0b` |

**互動效果**
```css
.nav-icon-btn:hover {
  background: rgba(255, 255, 255, 0.15);
}

.nav-icon-btn.active {
  background: rgba(255, 255, 255, 0.25);
  color: white;
}
```

---

### 3. 專案頁面入口 (ProjectPage)

**檔案**: `client/pages/ProjectPage.tsx` (44 行)

#### 功能
- ✅ 解析 URL 參數 `?view=project-page&id={projectId}`
- ✅ 驗證專案 ID 有效性
- ✅ 渲染 ProjectMainWindow 元件
- ✅ 提供關閉視窗功能

#### URL 參數處理
```typescript
const params = new URLSearchParams(window.location.search);
const projectId = params.get('id');
```

---

### 4. 首頁整合 (HomePage)

**檔案**: `client/components/Navigation/HomePage.tsx`

#### 修改內容

**專案統計區域重新排列**
```tsx
{/* 移至專案列表上方 */}
<div className="project-stats">
  <div className="stat-item">
    <span className="stat-label">專案總數</span>
    <span className="stat-value">{projects.length}</span>
  </div>
  <div className="stat-item">
    <span className="stat-label">資料庫狀態</span>
    <span className="stat-value connected">已連線</span>
  </div>
</div>
```

**專案卡片優化**
- 高度: 70px → **48px**
- 移除副標題顯示
- 單行緊湊布局

**新視窗開啟**
```typescript
onClick={() => {
  const projectWindow = window.open(
    `/?view=project-page&id=${project.id}`,
    `project-${project.id}`,
    'width=1400,height=900,left=100,top=50'
  );
  if (projectWindow) projectWindow.focus();
}}
```

**CSS 變更** (`client/components/Navigation/HomePage.css`)
```css
.project-card {
  height: 48px;           /* 從 min-height: 70px 改為固定高度 */
  padding: 0.625rem 1rem; /* 縮小內距 */
}

.project-stats {
  margin-bottom: 1rem;    /* 新增底部間距 */
}
```

---

### 5. 路由整合 (App.tsx)

**檔案**: `client/App.tsx`

#### 修改內容
```typescript
// 1. 新增 import
import ProjectPage from './pages/ProjectPage';

// 2. 擴展 PageView 類型
type PageView = 'home' | 'mindmap-manager' | 'project-page';

// 3. 新增路由判斷
if (params.get('view') === 'project-page') {
  setCurrentView('project-page');
}

// 4. 新增路由渲染
case 'project-page':
  return <ProjectPage />;
```

---

## 📁 檔案變更清單

### 新增檔案 (3)
1. ✅ `client/components/Project/ProjectMainWindow.tsx`
2. ✅ `client/components/Project/ProjectMainWindow.css`
3. ✅ `client/pages/ProjectPage.tsx`

### 修改檔案 (3)
1. ✅ `client/components/Navigation/HomePage.tsx`
   - 專案統計區移至列表上方
   - 專案卡片改為單行高度
   - 新增 window.open 新視窗開啟

2. ✅ `client/components/Navigation/HomePage.css`
   - .project-card 高度從 min-height: 70px 改為 height: 48px
   - 調整內距和字體大小
   - .project-stats 新增 margin-bottom

3. ✅ `client/App.tsx`
   - 新增 ProjectPage import
   - PageView 類型新增 'project-page'
   - 新增 project-page 路由判斷和渲染

---

## 🔍 技術細節

### 狀態管理
- **useState**: 管理專案資料、載入狀態、錯誤訊息、當前分頁
- **useEffect**: 元件掛載時自動載入專案資料

### API 整合
- **端點**: `GET /api/projects/:id`
- **回應格式**: `{ success: boolean, data: Project }`
- **錯誤處理**: try-catch 包裹,顯示錯誤訊息

### 視窗管理
- **window.open()**: 開啟新視窗
- **視窗尺寸**: 1400×900 像素
- **視窗位置**: left=100, top=50
- **視窗名稱**: `project-{id}` (避免重複開啟)

### 響應式設計
```css
@media (max-width: 768px) {
  .project-body {
    grid-template-columns: 60px 1fr;
  }
  .sidebar-medium {
    display: none;
  }
}
```

---

## ✅ 測試檢查清單

### 基本功能
- [x] 首頁顯示最新 5 個專案
- [x] 專案統計顯示在列表上方
- [x] 點擊專案卡片開啟新視窗
- [x] 新視窗顯示完整的專案主視窗
- [x] 四色布局正確顯示 (藍/紅/綠/黃)

### 互動功能
- [x] 點擊左側紅色導航圖標切換內容
- [x] 圖標 hover 效果正常
- [x] 選中狀態視覺回饋
- [x] 專案資料正確載入並顯示
- [x] 載入狀態正確顯示

### 錯誤處理
- [x] 無效的專案 ID 顯示錯誤訊息
- [x] API 錯誤正確捕獲並顯示
- [x] 網路錯誤處理

### 視覺效果
- [x] 標題列佔滿全寬
- [x] 三欄布局比例正確 (60px : 280px : 1fr)
- [x] 漸層背景正確顯示
- [x] 文字顏色對比度良好

---

## 🚀 後續優化建議

### 功能增強
1. [ ] 新增專案編輯功能
2. [ ] 實作檔案上傳與管理
3. [ ] 新增協作功能 (多人編輯)
4. [ ] 實作版本控制
5. [ ] 新增評論系統

### 效能優化
1. [ ] 實作虛擬滾動 (長列表)
2. [ ] 新增資料快取機制
3. [ ] 實作懶載入
4. [ ] 優化圖片載入

### 使用者體驗
1. [ ] 新增鍵盤快捷鍵
2. [ ] 實作拖放功能
3. [ ] 新增搜尋與篩選
4. [ ] 改善錯誤提示訊息
5. [ ] 新增操作引導

---

## 📊 程式碼統計

| 類型 | 檔案數 | 新增行數 | 修改行數 | 刪除行數 |
|------|--------|----------|----------|----------|
| TypeScript | 4 | 150+ | 30+ | 10+ |
| CSS | 2 | 100+ | 20+ | 0 |
| Markdown | 1 | 50+ | 5+ | 0 |
| **總計** | **7** | **300+** | **55+** | **10+** |

---

## 🎉 結論

專案主視窗功能已完整實作並整合至系統中,提供:

✅ **清晰的視覺層次**: 四色分區設計,每個區域功能明確  
✅ **流暢的互動體驗**: Hover 效果、選中狀態、平滑切換  
✅ **完整的錯誤處理**: 載入狀態、錯誤提示、容錯機制  
✅ **響應式設計**: 支援不同螢幕尺寸  
✅ **模組化架構**: 元件可重用、易於維護  

此功能為專案管理系統奠定了堅實的基礎,後續可持續擴展更多功能。

---

**更新者**: GitHub Copilot  
**審核者**: 待審核  
**狀態**: ✅ 完成並可用
