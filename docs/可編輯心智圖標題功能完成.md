# 可編輯心智圖標題功能完成

## 📋 更新內容

實作可編輯的心智圖標題，支援點擊編輯和自動保存。

## ✅ 完成項目

### 1. 可編輯標題 UI

#### **顯示模式**（預設）：
```
🧠 [我的心智圖] (點擊編輯)
    ↑ 灰底黑字
```

- **樣式**：
  - 背景色：`#e2e8f0`（淺灰）
  - 文字色：`#2d3748`（深黑）
  - 字體大小：`1.5rem`
  - 字體粗細：`600`（半粗體）
  - 圓角：`6px`
  - 內距：`4px 12px`

- **互動效果**：
  - ✅ 懸停時背景變深（`#cbd5e0`）
  - ✅ 懸停時顯示邊框（`#a0aec0`）
  - ✅ 平滑過渡動畫（`0.2s`）
  - ✅ 鼠標變為手型（`cursor: pointer`）
  - ✅ 顯示提示文字「(點擊編輯)」

#### **編輯模式**：
```
🧠 [輸入框_____] 
    ↑ 藍框高亮
```

- **樣式**：
  - 背景色：`#f7fafc`（淡藍灰）
  - 邊框：`2px solid #667eea`（紫藍色）
  - 文字色：`#2d3748`
  - 自動聚焦
  - 最小寬度：`200px`

- **互動效果**：
  - ✅ 點擊標題進入編輯模式
  - ✅ 自動選中輸入框
  - ✅ Enter 保存
  - ✅ Escape 取消
  - ✅ 失焦自動保存

### 2. 狀態管理

```typescript
const [isEditingName, setIsEditingName] = useState(false);
const [editingNameValue, setEditingNameValue] = useState<string>('');
```

### 3. 核心函數

#### **開始編輯**：
```typescript
const handleStartEditingName = () => {
  setIsEditingName(true);
  setEditingNameValue(currentMindMapName);
};
```

#### **保存名稱**：
```typescript
const handleSaveName = async () => {
  // 1. 驗證輸入
  if (!currentMindMapId || !editingNameValue.trim()) {
    setIsEditingName(false);
    return;
  }

  // 2. 呼叫 API
  const response = await fetch(`${API_BASE_URL}/mindmap/metadata/${currentMindMapId}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name: editingNameValue.trim() }),
  });

  // 3. 更新本地狀態
  if (data.success) {
    setCurrentMindMapName(editingNameValue.trim());
    console.log('✅ Name updated:', editingNameValue);
  }

  // 4. 關閉編輯模式
  setIsEditingName(false);
};
```

#### **取消編輯**：
```typescript
const handleCancelEditingName = () => {
  setIsEditingName(false);
  setEditingNameValue('');
};
```

#### **鍵盤快捷鍵**：
```typescript
const handleNameKeyDown = (e: React.KeyboardEvent) => {
  if (e.key === 'Enter') {
    handleSaveName();      // Enter = 保存
  } else if (e.key === 'Escape') {
    handleCancelEditingName();  // Escape = 取消
  }
};
```

### 4. API 整合

#### **後端 API**：
```
PUT /api/mindmap/metadata/:id
Body: { name: "新名稱" }
Response: { success: true, metadata: {...} }
```

這個 API 已經在之前實作完成，直接使用。

### 5. 使用者體驗

#### **編輯流程**：

```
1. 顯示模式
   └─ 灰底黑字標題
   └─ 懸停效果（背景變深 + 邊框）
   └─ 提示文字「(點擊編輯)」
   
2. 點擊標題
   └─ 進入編輯模式
   └─ 輸入框高亮（藍框）
   └─ 自動聚焦
   
3. 編輯名稱
   ├─ 輸入新名稱
   ├─ Enter 保存 → API 更新 → 完成
   ├─ Escape 取消 → 恢復原名稱
   └─ 失焦保存 → API 更新 → 完成
   
4. 完成
   └─ 回到顯示模式
   └─ 顯示新名稱
```

#### **多種保存方式**：

1. **Enter 鍵**：快速保存
2. **失焦（點擊外部）**：自動保存
3. **Escape 鍵**：取消編輯

### 6. 視覺效果

#### **灰底黑字標題**：

```css
/* 預設狀態 */
background: #e2e8f0;  /* 灰底 */
color: #2d3748;       /* 黑字 */
padding: 4px 12px;
border-radius: 6px;

/* 懸停狀態 */
background: #cbd5e0;  /* 深灰 */
border: 2px solid #a0aec0;  /* 灰色邊框 */

/* 編輯狀態 */
background: #f7fafc;  /* 淡灰 */
border: 2px solid #667eea;  /* 紫藍邊框 */
```

#### **互動動畫**：

- ✅ 懸停過渡：`transition: all 0.2s`
- ✅ 顏色平滑變化
- ✅ 邊框淡入淡出
- ✅ 鼠標手型指示

### 7. 錯誤處理

#### **驗證邏輯**：

```typescript
if (!currentMindMapId || !editingNameValue.trim()) {
  setIsEditingName(false);
  return;
}
```

- 空白名稱 → 取消編輯
- 無 ID → 取消編輯

#### **API 錯誤處理**：

```typescript
try {
  const response = await fetch(...);
  const data = await response.json();
  
  if (data.success) {
    // 成功更新
  } else {
    alert('更新名稱失敗');
  }
} catch (error) {
  console.error('Failed to update name:', error);
  alert('更新名稱失敗');
} finally {
  setIsEditingName(false);
}
```

## 🎨 UI 截圖描述

### 顯示模式：
```
┌────────────────────────────────────────────────┐
│ ← 返回管理器  🧠 我的專案心智圖 (點擊編輯)      │
│                                    🔄  💾       │
└────────────────────────────────────────────────┘
     ↑               ↑
   按鈕          灰底黑字標題
```

### 編輯模式：
```
┌────────────────────────────────────────────────┐
│ ← 返回管理器  🧠 [我的專案心智圖_________]      │
│                  ↑ 藍框高亮          🔄  💾     │
└────────────────────────────────────────────────┘
                   ↑
              輸入框（自動聚焦）
```

### 懸停效果：
```
┌────────────────────────────────────────────────┐
│ ← 返回管理器  🧠 我的專案心智圖 (點擊編輯)      │
│                  ↑ 深灰背景 + 邊框    🔄  💾    │
└────────────────────────────────────────────────┘
                   ↑
              鼠標懸停時
```

## 📦 完整程式碼

### 狀態定義：
```typescript
const [isEditingName, setIsEditingName] = useState(false);
const [editingNameValue, setEditingNameValue] = useState<string>('');
```

### UI 渲染：
```tsx
<div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
  <span style={{ fontSize: '1.5rem' }}>🧠</span>
  {isEditingName ? (
    <input
      type="text"
      value={editingNameValue}
      onChange={(e) => setEditingNameValue(e.target.value)}
      onBlur={handleSaveName}
      onKeyDown={handleNameKeyDown}
      autoFocus
      style={{
        fontSize: '1.5rem',
        fontWeight: 600,
        padding: '4px 12px',
        border: '2px solid #667eea',
        borderRadius: '6px',
        outline: 'none',
        background: '#f7fafc',
        color: '#2d3748',
        minWidth: '200px',
      }}
    />
  ) : (
    <div
      onClick={handleStartEditingName}
      style={{
        fontSize: '1.5rem',
        fontWeight: 600,
        padding: '4px 12px',
        background: '#e2e8f0',
        color: '#2d3748',
        borderRadius: '6px',
        cursor: 'pointer',
        transition: 'all 0.2s',
        border: '2px solid transparent',
      }}
    >
      {currentMindMapName}
    </div>
  )}
  {!isEditingName && (
    <span style={{ fontSize: '0.875rem', color: '#718096', fontStyle: 'italic' }}>
      (點擊編輯)
    </span>
  )}
</div>
```

## 🔄 完整流程

```
開啟心智圖
    ↓
顯示標題（灰底黑字）
    ↓ 鼠標懸停
背景變深 + 邊框
    ↓ 點擊
進入編輯模式
    ↓ 自動聚焦
輸入新名稱
    ↓ 選擇保存方式
    ├─ Enter → 保存
    ├─ 失焦 → 保存
    └─ Escape → 取消
    ↓
呼叫 API 更新
    ↓ 成功
更新本地狀態
    ↓
返回顯示模式（新名稱）
```

## ✨ 功能特色

1. **即時回饋**：
   - ✅ 懸停效果
   - ✅ 編輯高亮
   - ✅ 自動聚焦

2. **多種保存**：
   - ✅ Enter 鍵
   - ✅ 失焦
   - ✅ 自動保存

3. **優雅取消**：
   - ✅ Escape 鍵
   - ✅ 恢復原值

4. **視覺設計**：
   - ✅ 灰底黑字（清晰易讀）
   - ✅ 藍框高亮（編輯提示）
   - ✅ 平滑動畫（專業感）

5. **使用者友善**：
   - ✅ 提示文字「(點擊編輯)」
   - ✅ 懸停鼠標變手型
   - ✅ 錯誤提示

## 🎉 總結

✅ **可編輯心智圖標題功能完成！**

**核心特色**：
- 🎨 灰底黑字標題（清晰醒目）
- ✏️ 點擊即可編輯
- 💾 自動保存到後端
- ⌨️ 鍵盤快捷鍵支援
- ✨ 流暢的互動動畫

**使用方式**：
1. 點擊標題
2. 輸入新名稱
3. Enter 或失焦保存
4. 完成！

完美整合，體驗流暢！🚀
