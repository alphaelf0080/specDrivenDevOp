# 樹狀圖屬性面板功能

## 功能說明

將樹狀圖右側區域從工具按鈕改造為節點屬性面板，同時將所有工具按鈕集中到左側導覽區。

## 布局調整

### 三欄布局變更

| 區域 | 原始寬度 | 新寬度 | 用途 |
|------|---------|--------|------|
| 左側欄 | 80px | 80px | 工具導覽（6 個按鈕） |
| 中間欄 | 1fr | 1fr | 樹狀圖主視區 |
| 右側欄 | 80px | 320px | 節點屬性面板 |

### 左側導覽區工具按鈕

現在集中了所有 6 個功能按鈕：

| 圖示 | 功能 | 說明 |
|------|------|------|
| 🔍 | 過濾 | 節點過濾功能 |
| 📚 | 圖層 | 圖層管理 |
| 🔖 | 書籤 | 節點書籤 |
| ⚙️ | 設定 | 系統設定 |
| 💾 | 匯出 | 匯出功能 |
| 🔗 | 分享 | 分享連結 |

## 右側屬性面板

### 面板結構

```
┌──────────────────────────┐
│   節點屬性 (標題列)        │
├──────────────────────────┤
│                          │
│   [屬性內容區]            │
│   - ID                   │
│   - 標籤                  │
│   - 深度                  │
│   - 位置                  │
│   - 狀態                  │
│   - 顏色預覽              │
│                          │
└──────────────────────────┘
```

### 顯示屬性

當選取節點時，面板顯示：

| 屬性 | 說明 | 範例 |
|------|------|------|
| **ID** | 節點唯一識別碼 | `node-1` |
| **標籤** | 節點顯示文字 | `首頁` |
| **深度** | 節點在樹中的層級 | `0` (根節點) |
| **位置** | 節點座標 | `X: 100, Y: 200` |
| **狀態** | 展開/收合狀態 | `已展開` / `已收合` |
| **顏色** | 節點配色預覽 | 色塊顯示 |

### 未選取狀態

當沒有選取節點時，顯示提示：

```
     👆
  點擊節點查看屬性
```

## 視覺設計

### Dark 模式配色

| 元素 | 顏色 | 說明 |
|------|------|------|
| 面板背景 | `#1e293b` | 深藍灰 |
| 標題列背景 | `rgba(99, 102, 241, 0.1)` | 淡紫色調 |
| 標題文字 | `#f1f5f9` | 亮灰白 |
| 標籤文字 | `#94a3b8` | 中灰 |
| 內容文字 | `#e2e8f0` | 淡灰 |
| 分隔線 | `#334155` | 深灰藍 |

### 排版樣式

- **標題列**：大寫字母、間距加寬、粗體
- **屬性標籤**：小型大寫字母、灰色
- **屬性值**：中等大小、亮色、可斷行
- **分隔線**：屬性之間的視覺分隔

### 顏色預覽方塊

- 尺寸：48×32 像素
- 圓角：6px
- 陰影：`rgba(0, 0, 0, 0.4)`
- 顯示節點實際配色（背景色 + 邊框色）

## 互動行為

### 節點選取

1. 使用者點擊任何節點
2. 節點展開/收合（原有功能）
3. 同時更新右側屬性面板
4. 顯示選取節點的詳細資訊

### 狀態管理

使用 React `useState` hook：

```typescript
const [selectedNode, setSelectedNode] = useState<Node | null>(null);
```

### 事件處理

```typescript
const onNodeClick = useCallback((_e: any, node: Node) => {
  setCollapsed((prev) => ({ ...prev, [node.id]: !prev[node.id] }));
  setSelectedNode(node); // 更新選取節點
  onSelectNode && onSelectNode(node);
}, [onSelectNode]);
```

## 技術實作

### 修改檔案

1. **`client/components/Tree/TreeDiagram.tsx`**
   - 新增 `selectedNode` 狀態
   - 更新 `onNodeClick` 事件處理
   - 左側導覽區新增 3 個工具按鈕
   - 右側區域改為屬性面板 JSX

2. **`client/components/Tree/TreeDiagram.css`**
   - Grid 布局：`80px 1fr 320px`
   - 右側欄寬度改為 320px
   - 新增 `.property-panel` 相關樣式
   - 新增 `.property-section` 區段樣式
   - 新增 `.property-empty` 空狀態樣式

### 關鍵 CSS 類別

```css
.property-panel          /* 面板容器 */
.property-panel-title    /* 標題列 */
.property-content        /* 內容區域 */
.property-section        /* 屬性區段 */
.property-label          /* 屬性標籤 */
.property-value          /* 屬性值 */
.color-preview           /* 顏色預覽方塊 */
.property-empty          /* 空狀態容器 */
.empty-icon              /* 空狀態圖示 */
.empty-text              /* 空狀態文字 */
```

## 使用者體驗提升

### 優勢

✅ **資訊集中**：節點屬性一目了然  
✅ **工具整合**：左側統一管理所有工具  
✅ **視覺清晰**：右側專注顯示屬性  
✅ **即時回饋**：點擊節點立即顯示資訊  
✅ **空間利用**：320px 寬度適合顯示詳細資訊

### 視覺層次

1. **工具列**（頂部）：導覽控制
2. **左側欄**（80px）：功能工具
3. **中間欄**（1fr）：主視覺內容
4. **右側欄**（320px）：詳細資訊

## 未來擴展

### 屬性面板擴充

- [ ] 新增節點編輯功能
- [ ] 新增自訂屬性欄位
- [ ] 新增節點連結資訊
- [ ] 新增子節點列表
- [ ] 新增操作歷史記錄

### 工具按鈕功能實作

- [ ] 🔍 過濾：節點搜尋與篩選
- [ ] 📚 圖層：顯示/隱藏特定層級
- [ ] 🔖 書籤：快速跳轉常用節點
- [ ] ⚙️ 設定：樹狀圖顯示選項
- [ ] 💾 匯出：PNG/SVG/JSON 格式
- [ ] 🔗 分享：生成分享連結

### 互動增強

- [ ] 屬性面板可拖曳調整寬度
- [ ] 屬性面板可收合
- [ ] 支援鍵盤快捷鍵選取節點
- [ ] 節點多選功能
- [ ] 批次屬性編輯

## 相容性

- ✅ React Flow 11.11.4
- ✅ TypeScript 5.6.2
- ✅ Dark 模式配色
- ✅ 響應式布局
- ✅ 瀏覽器支援：Chrome, Firefox, Safari, Edge

## 測試建議

### 功能測試

1. 點擊不同節點，確認屬性面板更新
2. 驗證展開/收合狀態顯示正確
3. 檢查顏色預覽方塊配色
4. 測試未選取節點的空狀態
5. 驗證所有 6 個工具按鈕顯示正確

### 視覺測試

1. 檢查 320px 面板寬度是否合適
2. 驗證 Dark 模式配色對比度
3. 測試長文字的斷行處理
4. 確認分隔線視覺效果
5. 檢查空狀態圖示與文字對齊

### 效能測試

1. 大型樹狀圖（100+ 節點）選取速度
2. 快速連續點擊節點的反應
3. 屬性面板滾動流暢度
4. 記憶體使用狀況

## 總結

這次更新將樹狀圖系統的資訊架構重新優化：

- **左側**：工具操作區（整合所有功能）
- **中間**：視覺呈現區（專注樹狀圖）
- **右側**：資訊展示區（節點詳細屬性）

符合「工具 - 內容 - 資訊」的標準三欄式應用布局模式。
